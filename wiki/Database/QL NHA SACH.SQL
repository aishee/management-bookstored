CREATE DATABASE QL_BOOKSTORE
USE QL_BOOKSTORE

--ALTER TABLE THAMSO ADD ID INT IDENTITY(1,1) PRIMARY KEY
--ALTER TABLE PHIEUTON ADD MaSach CHAR(10) FOREIGN KEY REFERENCES SACH(MaSach)

CREATE TABLE THAMSO(
	Id INT IDENTITY(1,1) PRIMARY KEY,
	SL_NhapItNhat INT,
	SL_TonToiDaTruocNhap INT,
	SL_TonSauToiThieu INT,
	SoTienNoToiDa MONEY,
	SuDungQuyDinh BIT 
)
CREATE TABLE SACH(
	MaSach CHAR(10) PRIMARY KEY,
	TenSach NVARCHAR(100),
	TheLoai NVARCHAR(50),
	TacGia NVARCHAR(100),
	SL_Ton INT,
	DonGia MONEY,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE KHACHHANG(
	MaKH CHAR(10) PRIMARY KEY,
	HoTen NVARCHAR(100),
	DiaChi NVARCHAR(100),
	DienThoai NVARCHAR(20),
	Email NVARCHAR(50),
	SoTienNo MONEY,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE PHIEUNHAP(
	MaPN CHAR(10) PRIMARY KEY,
	NgayNhap SMALLDATETIME,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE CTPN(
	MaCTPN CHAR(10) PRIMARY KEY,
	MaPN CHAR(10) FOREIGN KEY REFERENCES PHIEUNHAP(MaPN),
	MaSach CHAR(10) FOREIGN KEY REFERENCES SACH(MaSach), /*Chỉ nhập các đầu sách có sl_tồn<300*/
	SL_Nhap INT,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE HOADON(
	MaHD CHAR(10) PRIMARY KEY,
	MaKH CHAR(10) FOREIGN KEY REFERENCES KHACHHANG(MaKH),
	NgayHD SMALLDATETIME,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE CTHD(
	MACTHD CHAR(10) PRIMARY KEY,
	MaSach CHAR(10) FOREIGN KEY REFERENCES SACH(MaSach), /*Chỉ bán cho khách hàng có Nợ<=20000*/
	MaHD CHAR(10) FOREIGN KEY REFERENCES HOADON(MaHD), /*SL_Ton_sau>=20*/
	SL_BAN INT,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE PHIEUTHUTIEN(
	MaThuTien CHAR(10)  PRIMARY KEY,
	MaKH CHAR(10) FOREIGN KEY REFERENCES KHACHHANG(MaKH), 
	NgayThu SMALLDATETIME,
	SoTienThu MONEY, /*SoTienThu<=SoTienNo trong Khách hàng*/
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE PHIEUTON(
	MaTon CHAR(10) PRIMARY KEY,
	MaSach CHAR(10) FOREIGN KEY REFERENCES SACH(MaSach),
	Thang INT,
	TonDau INT,
	TonPhatSinh INT,
	TonCuoi INT,
	XoaDuLieu BIT NOT NULL
)

CREATE TABLE CONGNO(
	MaCongNo CHAR(10) PRIMARY KEY,
	MaKH CHAR(10) FOREIGN KEY REFERENCES KHACHHANG(MaKH),
	Thang INT,
	NoDau MONEY,
	NoPhatSinh MONEY,
	NoCuoi MONEY,
	XoaDuLieu BIT NOT NULL
)

--THAMSO--
INSERT INTO THAMSO VALUES(150, 300, 20, 20000, 1)

--SACH--
INSERT INTO SACH VALUES('SH20140001', N'Kính Vạn Hoa', N'Truyện', N'Nguyễn Nhật Ánh', 205, 13325000, 0)
INSERT INTO SACH VALUES('SH20140002', N'Yêu nhầm chị hai được nhầm em gái', N'Tiểu Thuyết', N'Leo LeoAslan', 300, 25800000, 0)
INSERT INTO SACH VALUES('SH20140003', N'Căn nhà số 13', N'Kinh dị', N'Nguyễn Nam', 325, 4875000, 0)
INSERT INTO SACH VALUES('SH20140004', N'Harry Potter', N'Giả tưởng, huyền bí, kinh dị', N'J. K. Rowling', 150, 115650000, 0)

--KHACHHANG--
INSERT INTO KHACHHANG VALUES('KH2014001', N'Phạm Văn Nghệ', N'Tây Ninh','01656149012','ilovetayninh@gmail.com',0,0)
INSERT INTO KHACHHANG VALUES('KH2014002', N'Nguyễn Việt Phương', N'An Giang','09520295','phuongnv@gmail.com',20000,0)
INSERT INTO KHACHHANG VALUES('KH2014003', N'Đào Thu Vân', N'TP.HCM','0987654123','vandt@gmail.com',30000,0)
INSERT INTO KHACHHANG VALUES('KH2014004', N'Nguyễn Thanh An', N'TP.HCM','0127568123','annt@gmail.com',10000,0)

--PHIEUNHAP--
INSERT INTO PHIEUNHAP VALUES('N201400001','09/25/2014',0)
INSERT INTO PHIEUNHAP VALUES('N201400002','09/26/2014',0)
INSERT INTO PHIEUNHAP VALUES('N201400003','09/27/2014',0)

--CTPN--
INSERT INTO CTPN VALUES('CTPN201401','N201400001','SH20140001', 100,0)
INSERT INTO CTPN VALUES('CTPN201402','N201400002','SH20140004', 150,0)

--HOADON--
INSERT INTO HOADON VALUES('HD2014001','KH2014001', '09/25/2014',0)
INSERT INTO HOADON VALUES('HD2014002','KH2014002', '09/25/2014',0)
INSERT INTO HOADON VALUES('HD2014003','KH2014003', '09/26/2014',0)

--CTHD--
INSERT INTO CTHD VALUES('CTHD20141','SH20140001','HD2014001', 10,0)
INSERT INTO CTHD VALUES('CTHD20142','SH20140002','HD2014001', 3,0)
INSERT INTO CTHD VALUES('CTHD20143','SH20140003','HD2014002', 1,0)
INSERT INTO CTHD VALUES('CTHD20144','SH20140004','HD2014002', 32,0)
INSERT INTO CTHD VALUES('CTHD20145','SH20140001','HD2014003', 1,0)
INSERT INTO CTHD VALUES('CTHD20146','SH20140002','HD2014003', 3,0)
INSERT INTO CTHD VALUES('CTHD20147','SH20140003','HD2014003', 1,0)
INSERT INTO CTHD VALUES('CTHD20148','SH20140004','HD2014003', 10,0)

--PHIEUTHUTIEN--
INSERT INTO PHIEUTHUTIEN VALUES('TT201401','KH2014001','09/25/2014',300000,0)
INSERT INTO PHIEUTHUTIEN VALUES('TT201402','KH2014002','09/25/2014',1500000,0)

--PHIEUTON--
INSERT INTO PHIEUTON VALUES('T2014001','SH20140001',1,5,1,2,0)
INSERT INTO PHIEUTON VALUES('T2014002','SH20140002',1,6,3,1,0)

--CONGNO--
INSERT INTO CONGNO VALUES('C2014001','KH2014001',1,320000,25000,27000,0)
INSERT INTO CONGNO VALUES('C2014002','KH2014002',1,450000,50000,36000,0)